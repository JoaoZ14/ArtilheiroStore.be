<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#0f0f12">
  <title>Admin ‚Äì Artilheiro Store</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    :root {
      --bg: #0f0f12;
      --bg-page: #0a0a0d;
      --surface: #16161a;
      --surface-2: #1e1e24;
      --surface-hover: #25252c;
      --border: #2a2a32;
      --text: #f0f0f4;
      --text-2: #a0a0ac;
      --muted: #6b6b75;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --accent-soft: rgba(99, 102, 241, 0.12);
      --success: #22c55e;
      --success-soft: rgba(34, 197, 94, 0.15);
      --warning: #eab308;
      --warning-soft: rgba(234, 179, 8, 0.15);
      --error: #ef4444;
      --error-soft: rgba(239, 68, 68, 0.15);
      --info: #3b82f6;
      --info-soft: rgba(59, 130, 246, 0.15);
      --touch: 44px;
      --radius: 12px;
      --radius-sm: 8px;
      --sidebar-w: 240px;
      --sidebar-collapsed: 64px;
      --safe-bottom: env(safe-area-inset-bottom, 0);
      --safe-top: env(safe-area-inset-top, 0);
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
      font-size: 14px;
      line-height: 1.5;
      background: var(--bg-page);
      color: var(--text);
      min-height: 100vh;
      min-height: 100dvh;
      padding-bottom: var(--safe-bottom);
    }

    .app-shell { display: flex; min-height: 100vh; min-height: 100dvh; }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-w);
      min-width: var(--sidebar-w);
      background: var(--surface);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      transition: width .2s, min-width .2s;
      z-index: 60;
    }
    .sidebar.collapsed { width: var(--sidebar-collapsed); min-width: var(--sidebar-collapsed); }
    .sidebar-logo { padding: 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 12px; min-height: 64px; }
    .sidebar-logo span { font-weight: 700; font-size: 1.1rem; color: var(--text); white-space: nowrap; overflow: hidden; }
    .sidebar.collapsed .sidebar-logo span { display: none; }
    .sidebar-nav { flex: 1; padding: 12px 0; overflow-y: auto; }
    .sidebar-nav a {
      display: flex; align-items: center; gap: 12px; padding: 10px 20px; color: var(--text-2); text-decoration: none; transition: background .15s, color .15s; border-left: 3px solid transparent;
    }
    .sidebar-nav a:hover { background: var(--surface-hover); color: var(--text); }
    .sidebar-nav a.active { background: var(--accent-soft); color: var(--accent); border-left-color: var(--accent); font-weight: 500; }
    .sidebar-nav .nav-icon { font-size: 1.2rem; width: 24px; text-align: center; flex-shrink: 0; }
    .sidebar.collapsed .sidebar-nav a span { display: none; }
    .sidebar.collapsed .sidebar-nav a { justify-content: center; padding: 10px; }
    .sidebar-toggle { padding: 12px 20px; border-top: 1px solid var(--border); }
    .sidebar-toggle button { width: 100%; min-height: 36px; background: transparent; border: none; border-radius: var(--radius-sm); color: var(--text-2); cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: background .15s, color .15s; }
    .sidebar-toggle button:hover { background: var(--surface-hover); color: var(--text); }
    .sidebar.collapsed .sidebar-toggle button span { display: none; }
    @media (max-width: 768px) {
      .sidebar { position: fixed; left: 0; top: 0; bottom: 0; z-index: 70; }
      .sidebar.collapsed { width: 0; min-width: 0; overflow: hidden; }
      .main-content { padding: 16px; }
      .kpi-grid { grid-template-columns: 1fr 1fr; }
    }

    /* Main area */
    .main-wrap { flex: 1; display: flex; flex-direction: column; min-width: 0; }
    .topbar {
      min-height: 56px; padding: 0 24px; background: var(--surface); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; gap: 16px; flex-wrap: wrap;
    }
    .topbar-search { flex: 1; min-width: 200px; max-width: 360px; }
    .topbar-search input { width: 100%; min-height: 40px; padding: 0 14px 0 40px; background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text); font-size: 14px; }
    .topbar-search input::placeholder { color: var(--muted); }
    .topbar-actions { display: flex; align-items: center; gap: 12px; }
    .topbar-profile { width: 36px; height: 36px; border-radius: 50%; background: var(--accent-soft); color: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 0.85rem; }

    .main-content { flex: 1; padding: 24px; overflow-y: auto; }
    .panel { display: none; }
    .panel.active { display: block; }

    /* Dashboard KPI */
    .page-title { margin: 0 0 24px; font-size: 1.5rem; font-weight: 600; color: var(--text); }
    .kpi-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 16px; margin-bottom: 32px; }
    .kpi-card {
      background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; transition: border-color .15s, box-shadow .15s;
    }
    .kpi-card:hover { border-color: var(--border); box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
    .kpi-card .kpi-icon { width: 40px; height: 40px; border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; font-size: 1.25rem; margin-bottom: 12px; }
    .kpi-card .kpi-value { font-size: 1.5rem; font-weight: 700; color: var(--text); margin: 0 0 4px; }
    .kpi-card .kpi-label { font-size: 0.8rem; color: var(--muted); margin: 0; }
    .kpi-card .kpi-delta { font-size: 0.75rem; margin-top: 6px; }
    .kpi-card .kpi-delta.positive { color: var(--success); }
    .kpi-card .kpi-delta.negative { color: var(--error); }
    .kpi-card .kpi-delta.neutral { color: var(--muted); }

    /* Cards de lista: mobile-first (sempre cards no mobile) */
    .list-cards { display: flex; flex-direction: column; gap: 10px; }
    .card-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      min-height: var(--touch);
      padding: 14px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      text-decoration: none;
      color: inherit;
    }
    .card-row:active { background: var(--surface-2); }
    .card-row-main { flex: 1; min-width: 0; }
    .card-row-title { font-weight: 500; margin: 0 0 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .card-row-meta { font-size: 0.85rem; color: var(--muted); }
    .card-row-actions { flex-shrink: 0; }

    /* Tabela: s√≥ em telas maiores */
    .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .table-wrap table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    .table-wrap th, .table-wrap td { text-align: left; padding: 14px 12px; border-bottom: 1px solid var(--border); }
    .table-wrap th { color: var(--muted); font-weight: 500; font-size: 0.8rem; }
    .table-wrap tr:last-child td { border-bottom: none; }
    .table-wrap .mobile-only { display: none; }
    .table-wrap thead { position: sticky; top: 0; z-index: 10; background: var(--bg); box-shadow: 0 1px 0 var(--border); }
    .table-wrap tbody tr { cursor: pointer; transition: background .12s; }
    .table-wrap tbody tr:hover { background: var(--surface-2); }
    .table-wrap tbody tr:focus-within { outline: 2px solid var(--accent); outline-offset: -2px; }
    .order-code-cell { font-weight: 600; color: var(--accent); display: flex; align-items: center; gap: 6px; }
    .order-code-cell span { flex: 1; min-width: 0; }
    .btn-copy { min-height: 32px; padding: 0 8px; background: transparent; border: none; border-radius: var(--radius-sm); color: var(--text-2); cursor: pointer; transition: color .15s, background .15s; flex-shrink: 0; }
    .btn-copy:hover { color: var(--accent); background: var(--accent-soft); }
    .btn-copy:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }

    /* Bot√µes */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-height: var(--touch);
      padding: 0 20px;
      border: none;
      border-radius: var(--radius-sm);
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: background .15s, opacity .15s;
    }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .btn-primary { background: var(--accent); color: var(--bg); }
    .btn-primary:hover:not(:disabled) { background: var(--accent-hover); }
    .btn-secondary { background: var(--surface-2); color: var(--text); border: 1px solid var(--border); }
    .btn-secondary:hover:not(:disabled) { background: var(--border); }
    .btn:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
    .btn-block { width: 100%; }
    .btn-sm { min-height: 36px; padding: 0 14px; font-size: 0.85rem; }

    /* Formul√°rio */
    .form-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
    }
    .form-card h2 { margin: 0 0 20px; font-size: 1.1rem; }
    .field { margin-bottom: 16px; }
    .field:last-of-type { margin-bottom: 0; }
    label { display: block; margin-bottom: 6px; font-size: 0.85rem; font-weight: 500; color: var(--text-2); }
    input[type="text"], input[type="number"], input[type="datetime-local"], select {
      width: 100%;
      min-height: var(--touch);
      padding: 0 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-size: 16px; /* evita zoom no iOS */
    }
    input:focus-visible, select:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
    input[type="file"] { margin-top: 6px; font-size: 0.9rem; color: var(--text-2); }
    input[type="checkbox"] { width: 18px; height: 18px; margin-right: 8px; vertical-align: middle; }
    .form-actions { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
    .form-actions .btn { flex: 1; min-width: 120px; }

    /* Grid de campos: 1 col mobile, 2 cols desktop */
    .form-grid { display: grid; gap: 16px; }
    @media (min-width: 480px) { .form-grid { grid-template-columns: 1fr 1fr; } }

    /* Mensagens */
    .msg { margin-top: 16px; padding: 12px 14px; border-radius: var(--radius-sm); font-size: 0.9rem; }
    .msg.success { background: var(--success-soft); color: #81c784; }
    .msg.error { background: var(--error-soft); color: #e57373; }

    /* Badge status */
    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .badge-received, .badge-confirmed, .badge-preparing { background: var(--warning-soft); color: var(--warning); }
    .badge-shipped, .badge-in-transit { background: var(--info-soft); color: var(--info); }
    .badge-delivered { background: var(--success-soft); color: var(--success); }
    .badge-cancelled { background: var(--error-soft); color: var(--error); }

    /* Drawer */
    .drawer-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 90; opacity: 0; visibility: hidden; transition: opacity .2s, visibility .2s; }
    .drawer-overlay.open { opacity: 1; visibility: visible; }
    .drawer {
      position: fixed; top: 0; right: 0; width: 100%; max-width: 440px; height: 100%; background: var(--surface); border-left: 1px solid var(--border); z-index: 91;
      transform: translateX(100%); transition: transform .25s ease; overflow-y: auto; display: flex; flex-direction: column; box-shadow: -8px 0 32px rgba(0,0,0,0.3);
    }
    .drawer.open { transform: translateX(0); }
    .drawer-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-shrink: 0; }
    .drawer-header h2 { margin: 0; font-size: 1.15rem; font-weight: 600; }
    .drawer-close { width: 36px; height: 36px; border: none; border-radius: var(--radius-sm); background: transparent; color: var(--text-2); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.25rem; transition: background .15s, color .15s; }
    .drawer-close:hover { background: var(--surface-hover); color: var(--text); }
    .drawer-body { flex: 1; padding: 24px; overflow-y: auto; }

    /* Confirm modal */
    .confirm-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 110; display: none; align-items: center; justify-content: center; padding: 16px; }
    .confirm-overlay.open { display: flex; }
    .confirm-modal { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; max-width: 400px; width: 100%; }
    .confirm-modal h3 { margin: 0 0 8px; font-size: 1.1rem; }
    .confirm-modal p { margin: 0 0 20px; color: var(--text-2); font-size: 0.9rem; }
    .confirm-actions { display: flex; gap: 12px; justify-content: flex-end; }
    .confirm-actions .btn-danger { background: var(--error); color: #fff; }
    .confirm-actions .btn-danger:hover:not(:disabled) { background: #dc2626; }

    .empty { text-align: center; padding: 40px 20px; color: var(--muted); font-size: 0.95rem; }

    /* Skeleton loading */
    .skeleton { background: linear-gradient(90deg, var(--surface-2) 25%, var(--border) 50%, var(--surface-2) 75%); background-size: 200% 100%; animation: skeleton 1.2s ease-in-out infinite; border-radius: 4px; }
    @keyframes skeleton { to { background-position: 200% 0; } }
    .skeleton-row td { padding: 14px 10px; }
    .skeleton-row td span { display: block; height: 16px; }
    .spinner { width: 20px; height: 20px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin .7s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .btn .spinner { margin-right: 8px; }

    /* Toast */
    .toast-container { position: fixed; bottom: calc(24px + var(--safe-bottom)); left: 50%; transform: translateX(-50%); z-index: 200; display: flex; flex-direction: column; gap: 8px; max-width: 90vw; width: 360px; pointer-events: none; }
    .toast { padding: 14px 18px; border-radius: var(--radius-sm); font-size: 0.9rem; font-weight: 500; box-shadow: 0 4px 20px rgba(0,0,0,0.4); pointer-events: auto; animation: toastIn .25s ease; }
    .toast.success { background: var(--success); color: #fff; }
    .toast.error { background: var(--error); color: #fff; }
    @keyframes toastIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Detail modal: blocos */
    .detail-header { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 1px solid var(--border); }
    .detail-header h3 { margin: 0; font-size: 1.15rem; }
    .detail-block { margin-bottom: 24px; }
    .detail-block:last-of-type { margin-bottom: 0; }
    .detail-block-title { font-size: 0.8rem; font-weight: 600; color: var(--muted); text-transform: uppercase; letter-spacing: .04em; margin-bottom: 10px; }
    .detail-item { display: flex; align-items: center; gap: 14px; padding: 12px 0; border-bottom: 1px solid var(--border); }
    .detail-item:last-child { border-bottom: none; }
    .detail-item-thumb { width: 52px; height: 52px; border-radius: var(--radius-sm); background: var(--surface-2); object-fit: cover; flex-shrink: 0; }
    .detail-item-body { flex: 1; min-width: 0; }
    .detail-item-name { font-weight: 500; margin: 0 0 2px; }
    .detail-item-meta { font-size: 0.85rem; color: var(--muted); }
    .detail-item-price { font-weight: 500; white-space: nowrap; }
    .detail-summary { padding: 16px; background: var(--surface-2); border-radius: var(--radius-sm); font-weight: 600; font-size: 1.05rem; }

    /* Produtos: thumbnail, estoque */
    .product-thumb { width: 40px; height: 40px; border-radius: 6px; background: var(--surface-2); object-fit: cover; }
    .stock-low { color: var(--error); font-weight: 500; }
    .cell-actions { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }

    /* Carrossel de imagens do produto */
    .product-carousel { margin-bottom: 20px; }
    .product-carousel-inner { position: relative; border-radius: var(--radius); overflow: hidden; background: var(--surface-2); aspect-ratio: 4/3; max-height: 280px; min-height: 200px; }
    .product-carousel-inner .carousel-slide { position: absolute; inset: 0; opacity: 0; transition: opacity .25s; pointer-events: none; display: flex; align-items: center; justify-content: center; }
    .product-carousel-inner .carousel-slide.active { opacity: 1; pointer-events: auto; }
    .product-carousel-inner .carousel-slide img { width: 100%; height: 100%; object-fit: contain; display: block; }
    .product-carousel-nav { display: flex; align-items: center; justify-content: center; gap: 12px; margin-top: 10px; }
    .product-carousel-nav button { min-height: 36px; min-width: 36px; padding: 0; border: none; border-radius: 50%; background: var(--surface-2); color: var(--text); cursor: pointer; font-size: 1.2rem; line-height: 1; transition: background .15s, color .15s; }
    .product-carousel-nav button:hover { background: var(--accent-soft); color: var(--accent); }
    .product-carousel-nav button:focus-visible { outline: 2px solid var(--accent); outline-offset: 2px; }
    .product-carousel-dots { display: flex; gap: 6px; justify-content: center; flex-wrap: wrap; margin-top: 8px; }
    .product-carousel-dots button { width: 8px; height: 8px; padding: 0; border: none; border-radius: 50%; background: var(--border); cursor: pointer; transition: background .15s; }
    .product-carousel-dots button.active { background: var(--accent); }
    .product-carousel-dots button:hover { background: var(--text-2); }

    /* Modal: full-screen no mobile, centralizado no desktop */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      align-items: flex-end;
      justify-content: center;
      z-index: 100;
      padding: 0;
    }
    .modal-overlay.open { display: flex; }
    @media (min-width: 500px) {
      .modal-overlay { align-items: center; padding: 16px; }
    }
    .modal {
      width: 100%;
      max-width: 440px;
      max-height: 92vh;
      max-height: 92dvh;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius) var(--radius) 0 0;
      padding: 20px;
      padding-bottom: calc(20px + var(--safe-bottom));
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    @media (min-width: 500px) {
      .modal { border-radius: var(--radius); max-height: 90vh; }
    }
    .modal h3 { margin: 0 0 20px; font-size: 1.05rem; }
    .modal .field { margin-bottom: 14px; }
    .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; flex-wrap: wrap; }

    /* Top bar da se√ß√£o */
    .section-top { display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom: 16px; flex-wrap: wrap; }
    .section-top h2 { margin: 0; font-size: 1rem; font-weight: 600; color: var(--text-2); }

    /* Esconder tabela no mobile, mostrar cards; no desktop mostrar tabela */
    .products-cards, .orders-cards { display: block; }
    .products-table, .orders-table { display: none; }
    @media (min-width: 640px) {
      .products-cards, .orders-cards { display: none; }
      .products-table, .orders-table { display: block; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <span>Artilheiro</span>
      </div>
      <nav class="sidebar-nav">
        <a href="#" class="nav-link active" data-panel="dashboard"><span class="nav-icon">‚óâ</span><span>Dashboard</span></a>
        <a href="#" class="nav-link" data-panel="pedidos"><span class="nav-icon">üìã</span><span>Pedidos</span></a>
        <a href="#" class="nav-link" data-panel="produtos"><span class="nav-icon">üì¶</span><span>Produtos</span></a>
      </nav>
      <div class="sidebar-toggle">
        <button type="button" id="sidebar-toggle-btn" aria-label="Recolher menu"><span>‚óÄ</span></button>
      </div>
    </aside>
    <div class="main-wrap">
      <header class="topbar">
        <div class="topbar-search">
          <input type="search" id="global-search" placeholder="Buscar pedidos, produtos..." aria-label="Busca global" />
        </div>
        <div class="topbar-actions">
          <button type="button" class="btn btn-primary btn-sm" id="topbar-criar-produto" style="display: none;">+ Criar produto</button>
          <div class="topbar-profile" title="Admin">A</div>
        </div>
      </header>
      <main class="main-content">
        <div id="panel-dashboard" class="panel active" role="tabpanel">
          <h1 class="page-title">Vis√£o geral</h1>
          <div id="dashboard-kpis" class="kpi-grid"></div>
          <div id="dashboard-recent"></div>
        </div>
        <div id="panel-pedidos" class="panel" role="tabpanel" hidden>
          <div class="section-top">
            <h1 class="page-title">Pedidos</h1>
          </div>
          <div id="pedidos-list"></div>
        </div>
        <div id="panel-produtos" class="panel" role="tabpanel" hidden>
      <div class="section-top" style="margin-bottom: 20px;">
        <h1 class="page-title">Produtos</h1>
        <button type="button" class="btn btn-primary" id="btn-novo-produto">+ Novo</button>
      </div>
      <div class="products-toolbar" style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center; margin-bottom: 16px;">
        <input type="search" id="products-search" placeholder="Buscar por nome, time, categoria..." style="min-width: 220px; min-height: 40px; padding: 0 12px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text);" />
        <select id="products-filter-category" style="min-height: 40px; padding: 0 12px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text);">
          <option value="">Todas categorias</option>
        </select>
        <select id="products-filter-status" style="min-height: 40px; padding: 0 12px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text);">
          <option value="">Todos</option>
          <option value="active">Ativos</option>
          <option value="inactive">Inativos</option>
        </select>
        <label style="display: flex; align-items: center; gap: 8px; color: var(--text-2); font-size: 0.9rem;"><input type="checkbox" id="products-filter-lowstock" /> Estoque baixo</label>
        <select id="products-sort" style="min-height: 40px; padding: 0 12px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text);">
          <option value="name">Nome</option>
          <option value="price">Pre√ßo</option>
          <option value="stock">Estoque</option>
        </select>
      </div>
      <div id="products-bulk-bar" style="display: none; padding: 12px 16px; background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 16px; align-items: center; gap: 12px; flex-wrap: wrap; flex-direction: row;">
        <span id="products-bulk-count">0 selecionados</span>
        <button type="button" class="btn btn-sm btn-secondary" id="bulk-ativar">Ativar</button>
        <button type="button" class="btn btn-sm btn-secondary" id="bulk-desativar">Desativar</button>
      </div>
      <div id="produtos-list"></div>
      <div class="form-card" id="card-form-produto" style="display: none;">
        <h2 id="form-produto-title">Novo produto</h2>
        <div id="product-carousel-wrap" class="product-carousel" style="display: none;" aria-label="Fotos do produto">
          <div class="product-carousel-inner" id="product-carousel-inner"></div>
          <div class="product-carousel-nav" id="product-carousel-nav">
            <button type="button" id="carousel-prev" aria-label="Foto anterior">‚Äπ</button>
            <span id="carousel-counter">1 / 1</span>
            <button type="button" id="carousel-next" aria-label="Pr√≥xima foto">‚Ä∫</button>
          </div>
          <div class="product-carousel-dots" id="product-carousel-dots"></div>
        </div>
        <form id="form-produto">
          <input type="hidden" id="produto-id" name="id" />
          <div class="form-grid">
            <div class="field">
              <label for="name">Nome *</label>
              <input type="text" id="name" name="name" required placeholder="Ex: Camisa Flamengo 24/25" />
            </div>
            <div class="field">
              <label for="team">Time *</label>
              <input type="text" id="team" name="team" required placeholder="Ex: Flamengo" />
            </div>
          </div>
          <div class="form-grid">
            <div class="field">
              <label for="liga">Liga *</label>
              <input type="text" id="liga" name="liga" required placeholder="Ex: Brasileir√£o" />
            </div>
            <div class="field">
              <label for="category">Categoria *</label>
              <input type="text" id="category" name="category" required placeholder="Ex: Camisa" />
            </div>
          </div>
          <div class="form-grid">
            <div class="field">
              <label for="price">Pre√ßo *</label>
              <input type="number" id="price" name="price" step="0.01" min="0.01" required placeholder="199,90" inputmode="decimal" />
            </div>
            <div class="field">
              <label for="sizes">Tamanhos / Estoque *</label>
              <input type="text" id="sizes" name="sizes" required placeholder="Ex: P:5, M:10, G:8" aria-describedby="sizes-hint" />
              <span id="sizes-hint" class="field-hint">Tamanho:quantidade separados por v√≠rgula</span>
            </div>
          </div>
          <div class="field">
            <label><input type="checkbox" id="active" name="active" checked /> Ativo</label>
          </div>
          <div class="field">
            <label for="images">Imagens (opcional)</label>
            <input type="file" id="images" name="images" accept="image/jpeg,image/png,image/webp" multiple />
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="btn-cancel-produto">Cancelar</button>
            <button type="submit" class="btn btn-primary" id="btn-submit-produto">Salvar</button>
          </div>
        </form>
        <div id="msg-produto"></div>
      </div>
    </div>
      </main>
    </div>
  </div>

  <!-- Drawer Pedido -->
  <div id="drawer-pedido-overlay" class="drawer-overlay" aria-hidden="true"></div>
  <div id="drawer-pedido" class="drawer" role="dialog" aria-label="Detalhe do pedido">
    <div class="drawer-header">
      <h2>Pedido <span id="drawer-pedido-codigo"></span></h2>
      <button type="button" class="drawer-close" id="drawer-pedido-close" aria-label="Fechar">√ó</button>
    </div>
    <div class="drawer-body">
      <div class="detail-header" style="margin-bottom: 16px;">
        <span id="drawer-pedido-status-badge" class="badge"></span>
      </div>
      <div id="drawer-pedido-itens" class="detail-block">
        <div class="detail-block-title">Itens do pedido</div>
        <div id="drawer-pedido-itens-list"></div>
      </div>
      <div class="detail-block">
        <div class="detail-block-title">Resumo financeiro</div>
        <div class="detail-summary" id="drawer-pedido-total"></div>
      </div>
      <form id="form-pedido">
        <div class="detail-block">
          <div class="detail-block-title">Alterar status e envio</div>
          <input type="hidden" id="pedido-id" />
          <div class="field">
            <label for="pedido-status">Status</label>
            <select id="pedido-status" name="status">
              <option value="RECEIVED">Recebido</option>
              <option value="CONFIRMED">Confirmado</option>
              <option value="PREPARING">Em prepara√ß√£o</option>
              <option value="SHIPPED">Enviado</option>
              <option value="IN_TRANSIT">Em tr√¢nsito</option>
              <option value="DELIVERED">Entregue</option>
              <option value="CANCELLED">Cancelado</option>
            </select>
          </div>
          <div class="field">
            <label for="pedido-shippedAt">Data de envio</label>
            <input type="datetime-local" id="pedido-shippedAt" name="shippedAt" />
          </div>
          <div class="field">
            <label for="pedido-carrier">Transportadora</label>
            <input type="text" id="pedido-carrier" name="carrier" placeholder="Ex: Correios" />
          </div>
          <div class="field">
            <label for="pedido-trackingCode">C√≥digo de rastreio</label>
            <input type="text" id="pedido-trackingCode" name="trackingCode" placeholder="Ex: BR123456789" />
          </div>
          <div class="field">
            <label for="pedido-trackingUrl">Link de rastreio</label>
            <input type="text" id="pedido-trackingUrl" name="trackingUrl" placeholder="https://..." inputmode="url" />
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="btn-fechar-pedido">Fechar</button>
            <button type="submit" class="btn btn-primary">Salvar altera√ß√µes</button>
          </div>
        </div>
      </form>
      <div id="msg-pedido"></div>
    </div>
  </div>

  <!-- Confirm modal -->
  <div id="confirm-overlay" class="confirm-overlay">
    <div class="confirm-modal">
      <h3 id="confirm-title">Confirmar a√ß√£o</h3>
      <p id="confirm-message">Essa a√ß√£o n√£o pode ser desfeita.</p>
      <div class="confirm-actions">
        <button type="button" class="btn btn-secondary" id="confirm-cancel">Cancelar</button>
        <button type="button" class="btn btn-danger" id="confirm-ok">Confirmar</button>
      </div>
    </div>
  </div>

  <div id="toast-container" class="toast-container" aria-live="polite"></div>

  <script>
    const API_PRODUCTS = '/api/products';
    const API_ORDERS = '/api/orders';

    function parseSizes(str) {
      const out = {};
      if (!str || !str.trim()) return out;
      str.split(',').forEach(pair => {
        const parts = pair.trim().split(':').map(s => s.trim());
        const size = parts[0];
        const qty = parts[1] !== undefined ? parseInt(parts[1], 10) : 0;
        if (size) out[size] = isNaN(qty) ? 0 : qty;
      });
      return out;
    }

    function sizesToString(sizes) {
      if (!sizes || typeof sizes !== 'object') return '';
      return Object.entries(sizes).map(([s, q]) => s + ':' + q).join(', ');
    }

    function escapeHtml(s) {
      if (s == null) return '';
      const div = document.createElement('div');
      div.textContent = s;
      return div.innerHTML;
    }

    function formatDateTime(s) {
      if (!s) return '-';
      try {
        const d = new Date(s);
        return isNaN(d.getTime()) ? s : d.toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
      } catch (_) { return s; }
    }

    function formatDate(s) {
      if (!s) return '-';
      try {
        const d = new Date(s);
        return isNaN(d.getTime()) ? s : d.toLocaleDateString('pt-BR');
      } catch (_) { return s; }
    }

    function formatPrice(n) {
      return 'R$ ' + Number(n).toFixed(2).replace('.', ',');
    }

    function showToast(message, type) {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = 'toast ' + (type || 'success');
      toast.textContent = message;
      toast.setAttribute('role', 'alert');
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 4000);
    }

    function openConfirm(title, message, onConfirm) {
      document.getElementById('confirm-title').textContent = title;
      document.getElementById('confirm-message').textContent = message;
      document.getElementById('confirm-overlay').classList.add('open');
      const ok = document.getElementById('confirm-ok');
      const cancel = document.getElementById('confirm-cancel');
      const close = () => {
        document.getElementById('confirm-overlay').classList.remove('open');
        ok.onclick = null;
        cancel.onclick = null;
      };
      ok.onclick = () => { close(); onConfirm(); };
      cancel.onclick = close;
    }

    function statusBadgeClass(s) {
      const k = (s || '').toLowerCase().replace('_', '-');
      return 'badge badge-' + (k === 'cancelled' ? 'cancelled' : k === 'delivered' ? 'delivered' : k === 'shipped' || k === 'in-transit' ? 'shipped' : 'received');
    }

    // Dashboard
    async function loadDashboard() {
      const el = document.getElementById('dashboard-kpis');
      el.innerHTML = `
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--info-soft);">üìã</div><div class="kpi-value skeleton" style="height:28px;width:60px;"></div><p class="kpi-label">Total de pedidos</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--success-soft);">üìÖ</div><div class="kpi-value skeleton" style="height:28px;width:60px;"></div><p class="kpi-label">Pedidos hoje</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--accent-soft);">üí∞</div><div class="kpi-value skeleton" style="height:28px;width:80px;"></div><p class="kpi-label">Faturamento total</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--warning-soft);">üìÜ</div><div class="kpi-value skeleton" style="height:28px;width:80px;"></div><p class="kpi-label">Faturamento hoje</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--success-soft);">üì¶</div><div class="kpi-value skeleton" style="height:28px;width:50px;"></div><p class="kpi-label">Produtos ativos</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--error-soft);">‚ö†</div><div class="kpi-value skeleton" style="height:28px;width:50px;"></div><p class="kpi-label">Sem estoque</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--warning-soft);">‚è≥</div><div class="kpi-value skeleton" style="height:28px;width:50px;"></div><p class="kpi-label">Pedidos pendentes</p><p class="kpi-delta neutral">‚Äî</p></div>
      `;
      let orders = [], products = [];
      try {
        const [rO, rP] = await Promise.all([fetch(API_ORDERS + '/admin'), fetch(API_PRODUCTS + '/admin')]);
        orders = await rO.json();
        products = await rP.json();
      } catch (_) {}
      const today = new Date().toISOString().slice(0, 10);
      const ordersToday = orders.filter(o => (o.createdAt || '').toString().slice(0, 10) === today);
      const totalRevenue = orders.reduce((s, o) => s + Number(o.total || 0), 0);
      const revenueToday = ordersToday.reduce((s, o) => s + Number(o.total || 0), 0);
      const activeProducts = products.filter(p => p.active).length;
      const stockTotal = (p) => !p.sizes || typeof p.sizes !== 'object' ? 0 : Object.values(p.sizes).reduce((a, n) => a + (Number(n) || 0), 0);
      const outOfStock = products.filter(p => stockTotal(p) === 0).length;
      const pendingStatuses = ['RECEIVED', 'CONFIRMED', 'PREPARING'];
      const pendingOrders = orders.filter(o => pendingStatuses.includes((o.status || '').toUpperCase())).length;
      el.innerHTML = `
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--info-soft);">üìã</div><div class="kpi-value">${orders.length}</div><p class="kpi-label">Total de pedidos</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--success-soft);">üìÖ</div><div class="kpi-value">${ordersToday.length}</div><p class="kpi-label">Pedidos hoje</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--accent-soft);">üí∞</div><div class="kpi-value">${formatPrice(totalRevenue)}</div><p class="kpi-label">Faturamento total</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--warning-soft);">üìÜ</div><div class="kpi-value">${formatPrice(revenueToday)}</div><p class="kpi-label">Faturamento hoje</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--success-soft);">üì¶</div><div class="kpi-value">${activeProducts}</div><p class="kpi-label">Produtos ativos</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--error-soft);">‚ö†</div><div class="kpi-value">${outOfStock}</div><p class="kpi-label">Sem estoque</p><p class="kpi-delta neutral">‚Äî</p></div>
        <div class="kpi-card"><div class="kpi-icon" style="background:var(--warning-soft);">‚è≥</div><div class="kpi-value">${pendingOrders}</div><p class="kpi-label">Pedidos pendentes</p><p class="kpi-delta neutral">‚Äî</p></div>
      `;
      const recentEl = document.getElementById('dashboard-recent');
      const recentOrders = [...orders].sort((a,b) => new Date(b.createdAt||0) - new Date(a.createdAt||0)).slice(0, 5);
      if (recentOrders.length) {
        recentEl.innerHTML = `<div class="detail-block"><div class="detail-block-title">√öltimos pedidos</div><div class="table-wrap"><table><thead><tr><th>C√≥digo</th><th>Data</th><th>Total</th><th>Status</th><th></th></tr></thead><tbody>${recentOrders.map(o => `<tr data-id="${o.id}" role="button" tabindex="0"><td class="order-code-cell">${escapeHtml(o.orderCode)}</td><td>${formatDate(o.createdAt)}</td><td>${formatPrice(o.total)}</td><td><span class="${statusBadgeClass(o.status)}">${escapeHtml(o.status)}</span></td><td><button type="button" class="btn btn-secondary btn-sm btn-open-order" data-id="${o.id}">Ver</button></td></tr>`).join('')}</tbody></table></div></div>`;
        recentEl.querySelectorAll('.btn-open-order').forEach(b => b.addEventListener('click', (e) => { e.stopPropagation(); const o = orders.find(x => x.id === b.dataset.id); if (o) openOrderDrawer(o); }));
        recentEl.querySelectorAll('tbody tr').forEach(tr => tr.addEventListener('click', (e) => { if (e.target.closest('button')) return; const o = orders.find(x => x.id === tr.dataset.id); if (o) openOrderDrawer(o); }));
      } else recentEl.innerHTML = '<p class="empty">Nenhum pedido recente.</p>';
    }

    // Tabs
    let currentPanel = 'dashboard';
    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const panel = link.dataset.panel;
        if (!panel) return;
        currentPanel = panel;
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        document.querySelectorAll('.panel').forEach(p => { p.classList.remove('active'); p.setAttribute('hidden', ''); });
        const panelEl = document.getElementById('panel-' + panel);
        if (panelEl) { panelEl.classList.add('active'); panelEl.removeAttribute('hidden'); }
        document.getElementById('topbar-criar-produto').style.display = panel === 'produtos' ? '' : 'none';
        if (panel === 'dashboard') loadDashboard();
        if (panel === 'pedidos') loadPedidos();
        if (panel === 'produtos') loadProdutos();
      });
    });
    document.getElementById('sidebar-toggle-btn').addEventListener('click', () => {
      document.getElementById('sidebar').classList.toggle('collapsed');
      document.getElementById('sidebar-toggle-btn').querySelector('span').textContent = document.getElementById('sidebar').classList.contains('collapsed') ? '‚ñ∂' : '‚óÄ';
    });
    document.getElementById('bulk-ativar').addEventListener('click', async () => {
      const ids = [...productSelectedIds];
      const fakeBtn = { disabled: false };
      for (const id of ids) {
        const p = allProductsList.find(x => x.id === id);
        if (p && !p.active) await toggleProductActive(p, fakeBtn);
      }
      productSelectedIds.clear();
      updateProductsBulkBar();
      loadProdutos();
    });
    document.getElementById('bulk-desativar').addEventListener('click', () => {
      const n = productSelectedIds.size;
      if (!n) return;
      openConfirm('Desativar ' + n + ' produto(s)?', 'Os produtos ficar√£o indispon√≠veis na loja. Voc√™ pode reativ√°-los depois.', async () => {
        const ids = [...productSelectedIds];
        const fakeBtn = { disabled: false };
        for (const id of ids) {
          const p = allProductsList.find(x => x.id === id);
          if (p && p.active) await toggleProductActive(p, fakeBtn);
        }
        productSelectedIds.clear();
        updateProductsBulkBar();
        loadProdutos();
        showToast(n + ' produto(s) desativado(s).', 'success');
      });
    });

    function productStockTotal(p) {
      if (!p.sizes || typeof p.sizes !== 'object') return 0;
      return Object.values(p.sizes).reduce((a, n) => a + (Number(n) || 0), 0);
    }

    async function toggleProductActive(p, btnEl) {
      const newActive = !p.active;
      btnEl.disabled = true;
      try {
        const product = {
          name: p.name,
          team: p.team,
          liga: p.liga,
          category: p.category,
          price: p.price,
          sizes: p.sizes,
          active: newActive
        };
        const formData = new FormData();
        formData.append('product', new Blob([JSON.stringify(product)], { type: 'application/json' }), 'product.json');
        const res = await fetch(API_PRODUCTS + '/' + p.id, { method: 'PUT', body: formData });
        if (res.ok) {
          showToast(newActive ? 'Produto ativado.' : 'Produto desativado.', 'success');
          loadProdutos();
        } else {
          const data = await res.json().catch(() => ({}));
          showToast(data.message || 'Erro ao atualizar. Tente novamente.', 'error');
        }
      } catch (err) {
        showToast('Erro ao atualizar. Tente novamente.', 'error');
      }
      btnEl.disabled = false;
    }

    let allProductsList = [];
    let productSelectedIds = new Set();

    function applyProductsFilter() {
      const q = (document.getElementById('products-search')?.value || '').toLowerCase().trim();
      const cat = (document.getElementById('products-filter-category')?.value || '').toLowerCase();
      const statusFilter = document.getElementById('products-filter-status')?.value || '';
      const lowOnly = document.getElementById('products-filter-lowstock')?.checked || false;
      const sortBy = document.getElementById('products-sort')?.value || 'name';
      let list = allProductsList.filter(p => {
        if (q && !(p.name||'').toLowerCase().includes(q) && !(p.team||'').toLowerCase().includes(q) && !(p.category||'').toLowerCase().includes(q)) return false;
        if (cat && (p.category||'').toLowerCase() !== cat) return false;
        if (statusFilter === 'active' && !p.active) return false;
        if (statusFilter === 'inactive' && p.active) return false;
        if (lowOnly && productStockTotal(p) > 2) return false;
        return true;
      });
      list = [...list].sort((a, b) => {
        if (sortBy === 'price') return Number(a.price||0) - Number(b.price||0);
        if (sortBy === 'stock') return productStockTotal(a) - productStockTotal(b);
        return (a.name||'').localeCompare(b.name||'');
      });
      renderProdutosList(list);
    }

    function renderProdutosList(list) {
      const el = document.getElementById('produtos-list');
      if (!list.length) {
        el.innerHTML = '<p class="empty">Nenhum produto encontrado.</p>';
        return;
      }
      const badge = (p) => p.active ? '<span class="badge badge-delivered">Ativo</span>' : '<span class="badge badge-cancelled">Inativo</span>';
      const thumb = (p) => (p.images && p.images[0]) ? `<img class="product-thumb" src="${escapeHtml(p.images[0])}" alt="" loading="lazy">` : '<div class="product-thumb" aria-hidden="true"></div>';
      el.innerHTML = `
        <div class="products-cards list-cards">
          ${list.map(p => {
            const stock = productStockTotal(p);
            const checked = productSelectedIds.has(p.id) ? ' checked' : '';
            return `
            <div class="card-row" role="button" tabindex="0" data-id="${p.id}">
              <label onclick="event.stopPropagation()"><input type="checkbox" class="product-row-cb" data-id="${p.id}"${checked} /> </label>
              <div class="card-row-main">
                <p class="card-row-title">${escapeHtml(p.name)} ¬∑ ${escapeHtml(p.team)}</p>
                <p class="card-row-meta">${escapeHtml(p.category)} ¬∑ ${formatPrice(p.price)} ¬∑ Estoque: ${stock}${stock <= 2 ? ' (baixo)' : ''} ¬∑ ${badge(p)}</p>
              </div>
              <div class="card-row-actions">
                <button type="button" class="btn btn-sm ${p.active ? 'btn-secondary' : 'btn-primary'} btn-toggle-product" data-id="${p.id}">${p.active ? 'Desativar' : 'Ativar'}</button>
                <button type="button" class="btn btn-secondary btn-sm btn-edit-produto" data-id="${p.id}">Editar</button>
              </div>
            </div>`;
          }).join('')}
        </div>
        <div class="products-table table-wrap">
          <table>
            <thead><tr><th><input type="checkbox" id="product-select-all" aria-label="Selecionar todos" /></th><th></th><th>Nome</th><th>Time</th><th>Categoria</th><th>Pre√ßo</th><th>Estoque</th><th>Status</th><th></th></tr></thead>
            <tbody>
              ${list.map(p => {
                const stock = productStockTotal(p);
                const lowClass = stock <= 2 ? ' stock-low' : '';
                const checked = productSelectedIds.has(p.id) ? ' checked' : '';
                return `
                <tr role="button" tabindex="0" data-id="${p.id}">
                  <td onclick="event.stopPropagation()"><input type="checkbox" class="product-row-cb" data-id="${p.id}"${checked} /></td>
                  <td>${thumb(p)}</td>
                  <td>${escapeHtml(p.name)}</td>
                  <td>${escapeHtml(p.team)}</td>
                  <td>${escapeHtml(p.category)}</td>
                  <td>${formatPrice(p.price)}</td>
                  <td class="${lowClass}">${stock}</td>
                  <td>${badge(p)}</td>
                  <td class="cell-actions">
                    <button type="button" class="btn btn-sm ${p.active ? 'btn-secondary' : 'btn-primary'} btn-toggle-product" data-id="${p.id}">${p.active ? 'Desativar' : 'Ativar'}</button>
                    <button type="button" class="btn btn-secondary btn-sm btn-edit-produto" data-id="${p.id}">Editar</button>
                  </td>
                </tr>`;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
      const openProduct = (id) => {
        const p = allProductsList.find(x => x.id === id);
        if (p) openEditProduto(p);
      };
      el.querySelectorAll('.btn-edit-produto').forEach(b => {
        b.addEventListener('click', (e) => { e.stopPropagation(); openProduct(b.dataset.id); });
      });
      el.querySelectorAll('.btn-toggle-product').forEach(b => {
        b.addEventListener('click', (e) => { e.stopPropagation(); const p = allProductsList.find(x => x.id === b.dataset.id); if (p) toggleProductActive(p, b); });
      });
      el.querySelectorAll('.product-row-cb').forEach(cb => {
        cb.addEventListener('change', () => {
          if (cb.checked) productSelectedIds.add(cb.dataset.id); else productSelectedIds.delete(cb.dataset.id);
          updateProductsBulkBar();
        });
      });
      const selectAll = document.getElementById('product-select-all');
      if (selectAll) {
        selectAll.checked = list.length > 0 && list.every(p => productSelectedIds.has(p.id));
        selectAll.addEventListener('change', () => {
          list.forEach(p => { if (selectAll.checked) productSelectedIds.add(p.id); else productSelectedIds.delete(p.id); });
          el.querySelectorAll('.product-row-cb').forEach(c => { c.checked = selectAll.checked; });
          updateProductsBulkBar();
        });
      }
      el.querySelectorAll('.card-row[data-id]').forEach(row => {
        row.addEventListener('click', (e) => { if (!e.target.closest('label') && !e.target.closest('button')) openProduct(row.dataset.id); });
      });
      el.querySelectorAll('.products-table tbody tr[data-id]').forEach(row => {
        row.addEventListener('click', (e) => { if (!e.target.closest('td')?.querySelector('input[type=checkbox]') && !e.target.closest('button')) openProduct(row.dataset.id); });
      });
    }

    function updateProductsBulkBar() {
      const bar = document.getElementById('products-bulk-bar');
      const countEl = document.getElementById('products-bulk-count');
      const n = productSelectedIds.size;
      if (countEl) countEl.textContent = n + ' selecionado' + (n !== 1 ? 's' : '');
      bar.style.display = n ? 'flex' : 'none';
    }

    async function loadProdutos() {
      const el = document.getElementById('produtos-list');
      el.innerHTML = `<div class="products-table table-wrap"><table><thead><tr><th></th><th>Nome</th><th>Time</th><th>Categoria</th><th>Pre√ßo</th><th>Estoque</th><th>Status</th><th></th></tr></thead><tbody>${[1,2,3,4,5].map(() => '<tr class="skeleton-row"><td></td><td><span class="skeleton product-thumb"></span></td><td><span class="skeleton"></span></td><td><span class="skeleton"></span></td><td><span class="skeleton"></span></td><td><span class="skeleton"></span></td><td><span class="skeleton"></span></td><td><span class="skeleton"></span></td><td></td></tr>').join('')}</tbody></table></div>`;
      try {
        const res = await fetch(API_PRODUCTS + '/admin');
        allProductsList = await res.json();
      } catch (_) {
        allProductsList = [];
      }
      const catSelect = document.getElementById('products-filter-category');
      if (catSelect) {
        const cats = [...new Set(allProductsList.map(p => p.category).filter(Boolean))].sort();
        catSelect.innerHTML = '<option value="">Todas categorias</option>' + cats.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join('');
      }
      if (!window._productsFilterBound) {
        window._productsFilterBound = true;
        document.getElementById('products-search').addEventListener('input', applyProductsFilter);
        document.getElementById('products-filter-category').addEventListener('change', applyProductsFilter);
        document.getElementById('products-filter-status').addEventListener('change', applyProductsFilter);
        document.getElementById('products-filter-lowstock').addEventListener('change', applyProductsFilter);
        document.getElementById('products-sort').addEventListener('change', applyProductsFilter);
      }
      if (!allProductsList.length) {
        el.innerHTML = '<p class="empty">Nenhum produto. Use + Novo ou Criar produto para cadastrar.</p>';
        return;
      }
      applyProductsFilter();
    }

    let productCarouselIndex = 0;
    let productCarouselImages = [];

    function renderProductCarousel(images) {
      productCarouselImages = images || [];
      const wrap = document.getElementById('product-carousel-wrap');
      const inner = document.getElementById('product-carousel-inner');
      const counter = document.getElementById('carousel-counter');
      const dotsEl = document.getElementById('product-carousel-dots');
      if (!productCarouselImages.length) {
        wrap.style.display = 'none';
        return;
      }
      wrap.style.display = 'block';
      inner.innerHTML = productCarouselImages.map((url, i) =>
        `<div class="carousel-slide${i === 0 ? ' active' : ''}" data-index="${i}" role="tabpanel" aria-label="Foto ${i + 1} de ${productCarouselImages.length}">
          <img src="${escapeHtml(url)}" alt="Foto do produto ${i + 1}" loading="lazy" />
        </div>`
      ).join('');
      dotsEl.innerHTML = productCarouselImages.map((_, i) =>
        `<button type="button" class="${i === 0 ? 'active' : ''}" data-index="${i}" aria-label="Ir para foto ${i + 1}" aria-selected="${i === 0}"></button>`
      ).join('');
      productCarouselIndex = 0;
      counter.textContent = `1 / ${productCarouselImages.length}`;
      dotsEl.querySelectorAll('button').forEach((btn, i) => {
        btn.addEventListener('click', () => goCarousel(i));
      });
    }

    function goCarousel(index) {
      const n = productCarouselImages.length;
      if (n === 0) return;
      productCarouselIndex = ((index % n) + n) % n;
      document.querySelectorAll('#product-carousel-inner .carousel-slide').forEach((el, i) => {
        el.classList.toggle('active', i === productCarouselIndex);
      });
      document.querySelectorAll('#product-carousel-dots button').forEach((el, i) => {
        el.classList.toggle('active', i === productCarouselIndex);
        el.setAttribute('aria-selected', i === productCarouselIndex);
      });
      document.getElementById('carousel-counter').textContent = `${productCarouselIndex + 1} / ${n}`;
    }

    function openEditProduto(p) {
      document.getElementById('form-produto-title').textContent = 'Editar produto';
      document.getElementById('produto-id').value = p.id;
      document.getElementById('name').value = p.name;
      document.getElementById('team').value = p.team;
      document.getElementById('liga').value = p.liga;
      document.getElementById('category').value = p.category;
      document.getElementById('price').value = p.price;
      document.getElementById('sizes').value = sizesToString(p.sizes);
      document.getElementById('active').checked = p.active;
      document.getElementById('images').value = '';
      renderProductCarousel(p.images);
      document.getElementById('card-form-produto').style.display = 'block';
      document.getElementById('msg-produto').textContent = '';
      document.getElementById('card-form-produto').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function openNewProductForm() {
      document.getElementById('form-produto-title').textContent = 'Novo produto';
      document.getElementById('form-produto').reset();
      document.getElementById('produto-id').value = '';
      document.getElementById('active').checked = true;
      renderProductCarousel([]);
      document.getElementById('card-form-produto').style.display = 'block';
      document.getElementById('msg-produto').textContent = '';
      document.getElementById('card-form-produto').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    document.getElementById('btn-novo-produto').addEventListener('click', openNewProductForm);
    document.getElementById('topbar-criar-produto').addEventListener('click', () => { if (currentPanel !== 'produtos') { document.querySelector('.nav-link[data-panel="produtos"]').click(); setTimeout(openNewProductForm, 100); } else openNewProductForm(); });

    document.getElementById('carousel-prev').addEventListener('click', () => {
      if (productCarouselImages.length) goCarousel(productCarouselIndex - 1);
    });
    document.getElementById('carousel-next').addEventListener('click', () => {
      if (productCarouselImages.length) goCarousel(productCarouselIndex + 1);
    });

    document.getElementById('btn-cancel-produto').addEventListener('click', () => {
      document.getElementById('card-form-produto').style.display = 'none';
    });

    document.getElementById('form-produto').addEventListener('submit', async (e) => {
      e.preventDefault();
      const msgEl = document.getElementById('msg-produto');
      const btn = document.getElementById('btn-submit-produto');
      const id = document.getElementById('produto-id').value;
      const priceVal = document.getElementById('price').value.replace(',', '.');
      const price = parseFloat(priceVal);
      if (isNaN(price) || price <= 0) {
        msgEl.textContent = 'Pre√ßo inv√°lido.';
        msgEl.className = 'msg error';
        return;
      }
      const sizes = parseSizes(document.getElementById('sizes').value.trim());
      if (Object.keys(sizes).length === 0) {
        msgEl.textContent = 'Informe ao menos um tamanho (ex: P:5, M:10).';
        msgEl.className = 'msg error';
        return;
      }
      const product = {
        name: document.getElementById('name').value.trim(),
        team: document.getElementById('team').value.trim(),
        liga: document.getElementById('liga').value.trim(),
        category: document.getElementById('category').value.trim(),
        price,
        sizes,
        active: document.getElementById('active').checked
      };
      btn.disabled = true;
      const btnText = btn.textContent.trim() || 'Salvar';
      btn.innerHTML = '<span class="spinner" aria-hidden="true"></span> Salvando...';
      msgEl.textContent = '';
      try {
        const files = document.getElementById('images').files;
        const formData = new FormData();
        formData.append('product', new Blob([JSON.stringify(product)], { type: 'application/json' }), 'product.json');
        for (let i = 0; i < files.length; i++) formData.append('images', files[i], files[i].name);
        const url = id ? API_PRODUCTS + '/' + id : API_PRODUCTS;
        const method = id ? 'PUT' : 'POST';
        const res = await fetch(url, { method, body: formData });
        const data = await res.json().catch(() => ({}));
        if (res.ok) {
          msgEl.textContent = id ? 'Produto atualizado.' : 'Produto cadastrado.';
          msgEl.className = 'msg success';
          showToast(id ? 'Produto salvo com sucesso.' : 'Produto cadastrado com sucesso.', 'success');
          loadProdutos();
          document.getElementById('card-form-produto').style.display = 'none';
        } else {
          msgEl.textContent = data.message || 'Erro ao salvar produto. Tente novamente.';
          msgEl.className = 'msg error';
          showToast(msgEl.textContent, 'error');
        }
      } catch (err) {
        msgEl.textContent = 'Erro ao salvar produto. Tente novamente.';
        msgEl.className = 'msg error';
        showToast(msgEl.textContent, 'error');
      }
      btn.disabled = false;
      btn.textContent = btnText;
    });

    // Pedidos
    async function loadPedidos() {
      const el = document.getElementById('pedidos-list');
      el.innerHTML = `
        <div class="orders-table table-wrap">
          <table><thead><tr><th>C√≥digo</th><th>Data</th><th>Total</th><th>Status</th><th></th></tr></thead>
          <tbody>
            ${[1,2,3,4,5].map(() => '<tr class="skeleton-row"><td><span class="skeleton"></span></td><td><span class="skeleton"></span></td><td><span class="skeleton"></span></td><td><span class="skeleton"></span></td><td></td></tr>').join('')}
          </tbody></table>
        </div>
      `;
      let list = [];
      try {
        const res = await fetch(API_ORDERS + '/admin');
        list = await res.json();
      } catch (_) {
        list = [];
      }
      if (!list.length) {
        el.innerHTML = '<p class="empty">Nenhum pedido.</p>';
        return;
      }
      list.sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
      const statusClass = (s) => statusBadgeClass(s);
      el.innerHTML = `
        <div class="orders-cards list-cards">
          ${list.map(o => `
            <div class="card-row" role="button" tabindex="0" data-id="${o.id}" aria-label="Pedido ${escapeHtml(o.orderCode)}">
              <div class="card-row-main">
                <p class="card-row-title">${escapeHtml(o.orderCode)}</p>
                <p class="card-row-meta">${formatDate(o.createdAt)} ¬∑ ${formatPrice(o.total)} ¬∑ <span class="${statusClass(o.status)}">${escapeHtml(o.status)}</span></p>
              </div>
              <div class="card-row-actions">
                <button type="button" class="btn btn-secondary btn-sm btn-gerir-pedido" data-id="${o.id}" aria-label="Ver detalhes">Ver detalhes</button>
              </div>
            </div>
          `).join('')}
        </div>
        <div class="orders-table table-wrap">
          <table>
            <thead><tr><th>C√≥digo</th><th>Data</th><th>Total</th><th>Status</th><th></th></tr></thead>
            <tbody>
              ${list.map(o => `
                <tr role="button" tabindex="0" data-id="${o.id}" data-order-code="${escapeHtml(o.orderCode)}">
                  <td class="order-code-cell">
                    <span>${escapeHtml(o.orderCode)}</span>
                    <button type="button" class="btn-copy" title="Copiar c√≥digo" aria-label="Copiar c√≥digo do pedido" data-code="${escapeHtml(o.orderCode)}">üìã</button>
                  </td>
                  <td>${formatDate(o.createdAt)}</td>
                  <td>${formatPrice(o.total)}</td>
                  <td><span class="${statusClass(o.status)}">${escapeHtml(o.status)}</span></td>
                  <td><button type="button" class="btn btn-secondary btn-sm btn-gerir-pedido" data-id="${o.id}">Ver detalhes</button></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
      const openOrder = (id) => {
        const o = list.find(x => x.id === id);
        if (o) openOrderDrawer(o);
      };
      el.querySelectorAll('.btn-gerir-pedido').forEach(b => {
        b.addEventListener('click', (e) => { e.stopPropagation(); openOrder(b.dataset.id); });
      });
      el.querySelectorAll('.btn-copy').forEach(b => {
        b.addEventListener('click', (e) => {
          e.stopPropagation();
          navigator.clipboard.writeText(b.dataset.code || '').then(() => showToast('C√≥digo copiado.', 'success'));
        });
      });
      el.querySelectorAll('.card-row[data-id]').forEach(row => {
        row.addEventListener('click', () => openOrder(row.dataset.id));
        row.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openOrder(row.dataset.id); } });
      });
      el.querySelectorAll('.orders-table tbody tr[data-id]').forEach(row => {
        row.addEventListener('click', (e) => { if (!e.target.closest('button')) openOrder(row.dataset.id); });
        row.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); openOrder(row.dataset.id); } });
      });
    }

    function openOrderDrawer(o) {
      document.getElementById('drawer-pedido-codigo').textContent = o.orderCode;
      const badgeEl = document.getElementById('drawer-pedido-status-badge');
      badgeEl.textContent = o.status || 'RECEIVED';
      badgeEl.className = 'badge ' + statusBadgeClass(o.status);
      document.getElementById('pedido-id').value = o.id;
      document.getElementById('pedido-status').value = o.status || 'RECEIVED';
      document.getElementById('pedido-shippedAt').value = o.shippedAt ? o.shippedAt.slice(0, 16) : '';
      document.getElementById('pedido-carrier').value = o.carrier || '';
      document.getElementById('pedido-trackingCode').value = o.trackingCode || '';
      document.getElementById('pedido-trackingUrl').value = o.trackingUrl || '';
      document.getElementById('msg-pedido').textContent = '';
      const items = o.items || [];
      document.getElementById('drawer-pedido-itens-list').innerHTML = items.length ? items.map(it => {
        const img = (it.image || (it.images && it.images[0])) ? `<img class="detail-item-thumb" src="${escapeHtml(it.image || it.images[0])}" alt="" loading="lazy">` : '<div class="detail-item-thumb" style="background:var(--surface-2)" aria-hidden="true"></div>';
        const name = escapeHtml(it.name || 'Produto');
        const meta = [it.size, 'Qtd: ' + (it.quantity || 0)].filter(Boolean).join(' ¬∑ ');
        const price = formatPrice(it.price);
        return `<div class="detail-item">${img}<div class="detail-item-body"><p class="detail-item-name">${name}</p><p class="detail-item-meta">${escapeHtml(meta)}</p></div><div class="detail-item-price">${price}</div></div>`;
      }).join('') : '<p class="empty" style="padding:12px 0">Nenhum item.</p>';
      document.getElementById('drawer-pedido-total').textContent = 'Total: ' + formatPrice(o.total);
      document.getElementById('drawer-pedido-overlay').classList.add('open');
      document.getElementById('drawer-pedido').classList.add('open');
      document.getElementById('drawer-pedido-overlay').setAttribute('aria-hidden', 'false');
    }
    function closeOrderDrawer() {
      document.getElementById('drawer-pedido-overlay').classList.remove('open');
      document.getElementById('drawer-pedido').classList.remove('open');
      document.getElementById('drawer-pedido-overlay').setAttribute('aria-hidden', 'true');
    }

    document.getElementById('btn-fechar-pedido').addEventListener('click', closeOrderDrawer);
    document.getElementById('drawer-pedido-close').addEventListener('click', closeOrderDrawer);
    document.getElementById('drawer-pedido-overlay').addEventListener('click', closeOrderDrawer);

    document.getElementById('form-pedido').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('pedido-id').value;
      const msgEl = document.getElementById('msg-pedido');
      const shippedAt = document.getElementById('pedido-shippedAt').value;
      const payload = {
        status: document.getElementById('pedido-status').value,
        shippedAt: shippedAt ? shippedAt + ':00' : null,
        carrier: document.getElementById('pedido-carrier').value.trim() || null,
        trackingCode: document.getElementById('pedido-trackingCode').value.trim() || null,
        trackingUrl: document.getElementById('pedido-trackingUrl').value.trim() || null
      };
      try {
        const res = await fetch(API_ORDERS + '/' + id, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (res.ok) {
          msgEl.textContent = 'Status atualizado com sucesso.';
          msgEl.className = 'msg success';
          showToast('Status atualizado com sucesso.', 'success');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Salvar altera√ß√µes';
          loadPedidos();
          if (currentPanel === 'dashboard') loadDashboard();
          setTimeout(closeOrderDrawer, 600);
        } else {
          const data = await res.json().catch(() => ({}));
          msgEl.textContent = data.message || 'Erro ao atualizar. Tente novamente.';
          msgEl.className = 'msg error';
          showToast(msgEl.textContent, 'error');
        }
      } catch (err) {
        msgEl.textContent = 'Erro ao atualizar. Tente novamente.';
        msgEl.className = 'msg error';
        showToast(msgEl.textContent, 'error');
      }
      submitBtn.disabled = false;
      submitBtn.textContent = 'Salvar altera√ß√µes';
    });

    loadDashboard();
  </script>
</body>
</html>
